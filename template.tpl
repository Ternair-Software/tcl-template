___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Ternair Marketing Cloud Clicks Tracking",
  "categories": ["MARKETING", "PERSONALIZATION", "SESSION_RECORDING"],
  "brand": {
    "id": "Ternair",
    "displayName": "Ternair",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "The Ternair Marketing Cloud Clicks Tracking allow website owners to track visitors on websites and allows website owners to use this information in their Ternair Marketing Cloud Campaigns.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "clientSettings",
    "displayName": "Client settings",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "clientCode",
        "displayName": "Client Code",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "applicationCode",
        "displayName": "Application Code",
        "simpleValueType": true
      },
      {
        "type": "CHECKBOX",
        "name": "campaignInfoStoreInCookie",
        "checkboxText": "Store campaign information in client cookie",
        "simpleValueType": true,
        "help": "Select this option to save the page URL in a client cookie \u003cstrong\u003eif\u003c/strong\u003e it has campaign parameters (utm_*, gclid)."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "campaignInfo",
    "displayName": "Store campaign info in a cookie",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "urlParameters",
        "displayName": "URL parameters that trigger the storage",
        "simpleValueType": true,
        "help": "Comma-separated list of parameters that trigger storage. If the URL has any one of these, then the browser cookie will be updated with the current URL.",
        "defaultValue": "utm_source,utm_medium,utm_campaign,utm_term,utm_content,utm_id,gclid",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "urlCookieName",
        "displayName": "Cookie name campaign URL",
        "simpleValueType": true,
        "help": "Cookie name where to save the URL with the campaign parameters. The cookie will be a \u003cstrong\u003esession cookie\u003c/strong\u003e written on the parent domain and root path. \u003cstrong\u003eIf you change the cookie name, remember to update the template permissions!\u003c/strong\u003e",
        "defaultValue": "__tcl_campaignUrl",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "campaignInfoStoreInCookie",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultMapping",
    "displayName": "Default mapping",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "utm_campaign",
        "displayName": "utm_campaign",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "utm_source",
        "displayName": "utm_source",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "utm_medium",
        "displayName": "utm_medium",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "additionalMapping",
    "displayName": "Additional mapping",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "DynamicMapping",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Ternair Fieldname",
            "name": "ternairKey",
            "type": "TEXT",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "ternairValue",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ]
      }
    ],
    "help": "TID, fingerprint and URL are captured by default and therefore do not need to be added to mapping"
  },
  {
    "type": "GROUP",
    "name": "storage",
    "displayName": "Storage",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "cookieStorage",
        "checkboxText": "save in cookie",
        "simpleValueType": true,
        "defaultValue": true,
        "alwaysInSummary": true
      },
      {
        "type": "CHECKBOX",
        "name": "localStorage",
        "checkboxText": "save in local storage",
        "simpleValueType": true,
        "alwaysInSummary": true
      },
      {
        "type": "CHECKBOX",
        "name": "sessionStorage",
        "checkboxText": "save in session",
        "simpleValueType": true,
        "alwaysInSummary": true
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const logToConsole = require('logToConsole');

/* Start V3 */
const getUrl = require('getUrl');
const createQueue = require('createQueue');
const setCookie = require('setCookie');
const queryPermission = require('queryPermission');

const url = 'https://static.ternair.com/js/tcl-gtm.min.js';

let fail = false;

if (data.campaignInfoStoreInCookie) {
	// Check if URL has any of the params listed
	const paramsToFind = data.urlParameters.split(',');
	const queryString = getUrl('query');
	const queryParams = queryString.length ? queryString.split('&') : [];
  
	if (queryParams.filter(pair => paramsToFind.indexOf(pair.split('=')[0]) > -1).length) {
		if (queryPermission('set_cookies', data.urlCookieName)) {
			setCookie(data.urlCookieName, getUrl(), {
				domain: 'auto',
				path: '/'
			});
		} else {
			logToConsole('No permissions to write ' + data.urlCookieName + ' cookie!');
			fail = true;
		}
	}
}

if (fail) {
	data.gtmOnFailure();
} else {
  /* End V3 */

  injectScript(url, function () {
    logToConsole('Inject Script Callback');

    const tclSend = copyFromWindow("tclSend");

    logToConsole('tclSend: ' + tclSend);
    logToConsole('clientCode: ' + data.clientCode);
    logToConsole('applicationCode: ' + data.applicationCode);
    logToConsole('utm_campaign: ' + data.utm_campaign);
    logToConsole('utm_medium: ' + data.utm_medium);
    logToConsole('utm_source: ' + data.utm_source);
    
    logToConsole('cookieStorage: ' + data.cookieStorage);
    logToConsole('localStorage: ' + data.localStorage);
    logToConsole('sessionStorage: ' + data.sessionStorage);    

    if (data.DynamicMapping) {
      logToConsole('DynamicMapping.length: ' + data.DynamicMapping.length);
      data.DynamicMapping.forEach((m, i) => logToConsole('DynamicMapping[' + i + ']', m));
    }

    const payload = {
      utm_campaign: data.utm_campaign,
      utm_medium: data.utm_medium,
      utm_source: data.utm_source,
      cookieStorage: data.cookieStorage,
      localStorage: data.localStorage,
      sessionStorage: data.sessionStorage
    };

    // Add the dynamic mapping key and values to the payload
    if (data.DynamicMapping) {
      data.DynamicMapping.forEach(m => payload[m.ternairKey] = m.ternairValue);
    }

    tclSend(data.clientCode, data.applicationCode, payload);

    data.gtmOnSuccess();

  }, data.gtmOnFailure);
} //V3


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://static.ternair.com/js/tcl-gtm.min.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "tclSend"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__tcl_campaignUrl"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 5-10-2020 11:49:46


